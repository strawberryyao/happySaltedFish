---
layout: post
title:  "传输层"
date:   2020-07-02
desc: "about internet network"
keywords: "TCP UDP"
categories: [Network]
tags: [strawberry]
icon: icon-html
---

## 传输层的基本服务
传输层：除应用层外唯一的端到端层，向上为各种网络应用提供端到端的报文传输服务，向下使用网络层提供的分组传输服务

#### 一.传输层的基本功能
传输层主要实现的功能：
- 传输层寻址
- 对应用层报文进行分段和重组
- 对报文进行差错监测
- 实现进程间的端到端可靠数据传输控制
- 面向应用层实现复用与分解(multiplexing/demultiplexing)
- 实现端到端的流量控制
- 拥塞控制

硬件端口：不同硬件设备进行交互的接口
软件接口：是应用层的各种应用协议进程与传输层协议实体进行层间交互的一种地址

#### 二.传输层的复用与分解
在同一主机上，多个进程同时利用同一个传输层协议(比如UDP或TCP协议)进行网络通信，此时该传输层协议就被多个应用进程复用;另外传输层接收到的报文段中，可能封装了不同应用进程的数据，传输层协议需要(通过正确的端口号)将数据交付给正确的应用进程，即实现分解

***实现复用与分解的关键是传输层能够唯一标识一个套接字***


1. 多路分解
在接收主机中的传输层实际上并没有直接将数据交付给进程，而是将数据交付给了与接收进程相关联的一个中间套接字，每个套接字必须有唯一的标识符，传输层基于这个唯一标识符将数据交付给正确的套接字，进而交付给正确的进程，实现分解．

2. 多路复用
在源主机，传输层协议从不同套接字收集应用进程(可能是不同的网络应用)发送的数据块，并为每个数据块封装上首部信息(包括用于分解的信息)构成报文段，然后将报文段传递给网络层，这一过程就是多路复用．

为UDP套接字分配端口号的两种方法：
- 创建一个UDP套接字时，传输层自动地为该套接字分配一个端口号(通常从1024~65535分配一个端口号),改端口号当前未被该主机中任何其他UDP套接字使用;
- 在创建一个UDP套接字后,通过调用bind()函数为该套接字绑定一个特定的端口号
  
**标识UDP套接字是一个二元组:<目的IP地址,目的端口号>**

**面向连接的多路复用与分解**
标识TCP套接字的是一个四元组:<源IP地址,源端口号,目的IP地址,目的端口号>
注意：
源端口号和目的端口号是TCP报文段首部字段
源IP地址和目的IP地址是IP数据报的首部字段

***TCP与UDP套接字差别:***
当TCP接收到两个具有不同的源IP地址或源端口号的TCP报文段时，即便两个报文段的目的IP地址和目的端口号相同,TCP也会将两个报文段分解到两个不同的套接字．

---

## 停-等协议与滑动窗口协议

#### 一、可靠数据传输基本原理
实现可靠数据传输的措施主要包括:
1. 差错检测:
发送方对需要检测差错的数据,如协议数据单元,进行差错编码(通常在数据后附加冗余信息,这种冗余信息建立了数据之间的某种逻辑关联),然后将编码后的数据发送给接收方;接收方依据相同的差错编码规则,监测数据传输过程中是否发生比特差错.
2. 确认:
接收方向发送方反馈接收状态.基于差错编码的差错监测结果,如果接收的数据未发生差错,并且是接收方期望接收的数据,则接收方返回ACK(Positive Acknowledgment)数据包,称为肯定确认,表示已正确接收数据;否则发送NAK(Negative Acknowledgment),称为否定确认,表示没有正确接收数据.
3. 重传:
发送方重新发送接收方没有正确接收的数据.发送方收到ACK数据包,则继续发送;收到NAK,则将出错的数据包重新向接收方发送,纠正出错的数据传输.
4. 序号:
确保数据按序提交.由于底层信道不可靠,可能出现乱序.对数据包进行编号,接收方可以根据数据包的序号纠正数据顺序,实现向上层按序提交数据;另外,可以避免由于重传可能引起的重复数据被提交的问题.
5. 计时器:
解决数据丢失问题.当发生数据丢失时,接收方不会收到相应的数据包,也就不会对丢失的数据包进行确认,发送方也不会重发丢失的数据包来纠正错误.引入计时器后,发送方在发送了数据包后就启动计时器,在计时器发生超时时还没有收到接收方的确认,就主动重发数据包,从而可以纠正数据丢失的问题.如果计时器超时设置太短,则可能导致原本没有丢失的数据也被重发,导致接收方可能收到两份(甚至多份)相同的数据包副本,可能会浪费网络传输能力,但是接收方可以根据重复数据包序号判断出是重复数据包,丢弃重复的数据包.

基于可靠数据传输的措施设计的具有代表性的可靠数据传输协议:停-等协议,滑动窗口协议

#### 二、停-等协议
基本原理:
当发送方向接收方发送一个报文段后,就停下来等待接收方的确认,如果收到ACK,则可以发送新的报文段;如果收到NAK或者超时,则重发刚发送的报文段,直到收到ACK为止.

基于以上重传机制的可靠数据传输协议称为自动重传情求(Automatic RepeatreQuest)协议.最简单的ARQ协议就是停-等协议.
1. 停-等协议的基本工作过程:
  - 发送方发送经过差错编码和编号的报文段,等待接受方的确认;
  - 如果接收方正确接收报文段,即差错检测无误且序号正确,则接收报文段,并向发送方发送ACK,否则丢弃报文段,并向发送发发送NAK;
  - 发送方如果收到ACK,则继续发送后续报文段,否则重发刚刚发送的报文段
2. 停-等协议特点:
简单,所需缓冲存储空间小, Ws = 1, Wr = 1,特殊的滑动窗口协议

#### 三、滑动窗口协议
在这种可靠数据传输协议中,从发送方向接收方传送的系列分组可以看成是填充到一条流水线(或一条管道)中,故称这种协议为流水线协议或管道协议
两个典型的滑动窗口协议
1. GBN协议(回退N步) 发送窗口 Ws>=1 , 接收窗口 Wr = 1
2. SR协议(选择重传) 发送窗口 Ws>=1 , 接收窗口 Wr>=1

---

## 用户数据报协议(UDP)
***为什么应用开发人员宁愿在UDP之上构建应用,而不选择在可靠的TCP上构建应用呢?***
- 应用进程更容易控制发送什么数据以及合适发送
- 无需建立连接
- 无连接状态
- 收不开销小
  
####  一、UDP数据报结构
UDP首部只有4个字段,每个字段由两个字节组成
1. 源端口号
2. 目的端口号
3. 长度
4. 校验和

#### 二、UDP校验和
校验和计算: 适用于UDP、TCP、IP首部校验和计算
发送方生成校验和(即反码):将参与计算校验和的这些16位的二进制数进行1的补码和(one's complement sum)运算,累加的结果再取反码即生成了检验码,将校验码放入校验和字段中.
其中1的补码和运算，即带循环进位(end round carry)的加法，最高位有进位应循环进到最低位

```
  数据1:    1 0 0 1 1 1 0 0   0 0 0 1 1 0 1 0
  数据2:    1 1 0 1 1 0 1 0   1 0 0 0 1 0 0 0
  求和:     0 1 1 1 0 1 1 0   1 0 1 0 0 0 1 1
  数据3:    1 0 1 0 1 1 0 1   0 0 1 1 0 1 0 1
  求和:     0 0 1 0 0 0 1 1   1 1 0 1 1 0 0 1
  反码:     1 1 0 1 1 1 0 0   0 0 1 0 0 1 1 0
```

接收方将数据1,数据2,数据3求和并加上接收方传送的校验和字段(值为1)
接收方校验检验和
1. 接收方将接收的数据(包括检验和字段)按发送方的同样的方法进行1的补码和运算，累加的结果再取反码。
2. 校验，如果上步的结果为0，表示传输正确；否则，说明传输有差错。

---

## 传输控制协议(TCP)
#### 一、TCP报文段结构
1. 远端口号与目的端口号字段分别占16位,标识发送该报文段的源端口和目的端口,用于多路复用/分解来层或送到上层应用的数据
2. 序号字段与确认序号字段分别占32位.TCP的序号是对每个应用层数据的每个字节进行编号,因此每个TCP报文段的序号是该段所封装的应用层数据的第一个字节的序号.确认序号是期望从对方接收数据的字节序号.即该序号对应的字节尚未收到,该讯号之前的字节已全部接收.TCP采用累积确认机制.
3. 首部长度字段占4位,指出TCP段的首部长度,以4字节为计算单位
4. 保留字段占6位,保留为今后使用,目前值为0
5. URG,ACK,PSH,SYN和FIN字段各占1位,共占6位,为6位标志位(字段).
  URG=1时,表明紧急指针字段有效,通知系统此报文段中有紧急数据,应尽快传送(相当于高优先级的数据),
  ACK=1时,标识确认序号字段,当ACK=0时,确认序号字段无效
  PSH=1时,需尽快将报文段中的数据接收应用进程,而不再等到整个缓存都填满后再向上交付
  RST=1时,表示TCP连接中出现严重差错(如主机崩溃或其他原因),必须释放连接,然后再重新建立TCP连接
  SYN=1时,表示该TCP报文段是一个建立新连接请求控制段或者是同意建立新连接的确认段(此时ACK=1);
  FIN=1时;表明该TCP报文段的发送端数据已发送完毕,并请求释放TCP连接
6. 接收窗口字段占16位,用于向对方通告接收窗口大小(单位为字节),用于向对方通告接收窗口大小,表示接收方愿意(或还可以)接受的应用层数据字节流量,其值是本端接收对方数据的缓存缓存剩余空间,用于实现TCP的流量控制.
7. 校验和字段占16位,计算方法类似于UDP
8. 紧急指针字段占16位,该字段在URG=1时才有效.紧急指针字段指出在本TCP报文段中紧急数据共有多少个字节.接收窗口大小为0时,也可以发送紧急数据
9. 选项字段的长度可变
10. 填充字段,长度为0-3字节,取值全0,使整个首部长度是4字节的证整数倍.

#### 二、TCP连接管理
***TCP连接建立通过"三次握手"***
第一次握手: 客户端作为连接建立发起端,发送SYN段连接建立请求 SYN=1,选择客户端序号seq=x,状态由LISTEN变成ACK_SEND,该次请求不封装应用层数据,等待服务器确认.  
第二次握手: 服务端收到客户端发送的SYN段连接请求,回复客户端SYNACK段 SYN=1,ACK=1,ack_seq=x+1,seq=y, 状态由LISTEN,被动打开变为ACK_RCVD  
第三次握手: 客户端收到服务端的SYNACK段后,向服务器发送ACK=1,seq=x+1,ack_seq=y+1,该次请求可以封装应用层数据,客户端状态由ACK_SEND变为ESTABLISH,当服务器收到ACK段后,状态由ACK_SEND变为ESTABLISH状态.至此,双方均确认连接请求建立成功.  

***TCP释放连接过程为"四次挥手过程"***
TCP断开连接可以由客户端或服务端任一方发起,假定由客户端先发起  
第一次挥手: 客户端发起连接断开请求,发送FIN段，FIN段不封装应用层数据: FIN=1, seq=u,客户端状态由ESTABLISH变为FIN_WAIT_1状态，此时客户端只能接收而不再发送数据  
第二次挥手: 服务端收到客户端发送的FIN段后，向客户端返回ACK段, 发送ACK=1,ack_seq=u+1,seq=v,状态由ESTABLISH变为CLOSE_WAIT,此状态下服务器不再接收数据,但是可以继续传送数据
          客户端的状态由FIN_WAIT_1变为FIN_WAIT_2,此状态下已关闭客户端向服务器方向传输数据,但仍然可以接收服务端的数据,此时称为半关闭状态  
第三次挥手: 服务端向客户端发送完最后的数据以后，服务端向客户端发送FIN段准备释放请求：FIN=1，ack_seq=u+1,ACK=1,seq=w,服务端状态由CLOSE_WAIT变成LAST_ACK,此时服务端也不再发送数据  
第四次挥手: 客户端向服务端传送ACK段: ACK=1,ack_seq=w+1,seq=u+1.客户端状态从FIN_WAIT_2进入TIME_WAIT等待2MSL时间然后进入CLOSED状态.服务端收到客户端的ACK段后,状态由LAST_ACK变为CLOSED,最终释放连接

#### 三、TCP可靠数据传输
TCP的可靠数据传输是基于滑动窗口协议,但是发送窗口大小动态变化.
TCP的发送窗口取决于流量控制的接收端通告的窗口大小和实现拥塞控制的拥塞窗口大小,任一时刻TCP发送窗口都取这两个窗口的最小值
**TCP提供可靠数据传输的工作机制(TCP如何保证可靠数据传输)**



TCP能够提供流量控制: (传输层和数据链路层)
目的:协调协议发送方与接收方的数据发送与接收速度
TCP的每一方都在建立连接时分配一定大小的接收缓存空间.接收端只允许另一段发送接收端缓冲区所能接纳的数据

TCP拥塞控制: (传输层和网络层)
拥塞是指太多主机以太快的速度向网络中发送太多的数据,超出了网络处理能力,导致大量数据分组"拥挤"在网络中间设备(如路由器)队列中等待转发,网络性能显著下降的现象.

拥塞控制策略:
 1)拥塞预防: 通过采取一些技术预防拥塞的发生
 2)拥塞消除: 利用拥塞检测机制检测网络中是否发生拥塞,然后通过某种方法消除已发生的拥塞.需要基于某种拥塞检测机制

 根据拥塞检测机制不同:
 1)基于拥塞状态反馈的拥塞控制方法: 网络层虚电路网络
 2)无需拥塞状态反馈的拥塞控制方法:在主机(即端系统)推断网络是否发生拥塞 传输层的拥塞控制,通过判断报文段的超时来推断网络是否发生拥塞


TCP拥塞控制窗口调节
慢启动(slow start)阶段
拥塞避免(congestion avoidance)阶段

**TCP拥塞控制算法:加性增加,乘性减小**
慢启动
拥塞避免
快速重传(fast retransmit)
快速恢复(fast recovery)
具体实现: 设置一个拥塞窗口阀值(Threshold),当拥塞窗口小于这个值时,拥塞窗口按慢启动方式增长;当大于该值时,按拥塞避免方式增长
在慢启动阶段,每收到一个确认段,拥塞窗口增加1个MSS,每经过1个RTT,拥塞窗口增长1倍,在1个RTT时间内可以将窗口允许的所有报文段全部发送出去
在拥塞避免阶段,将拥塞窗口内的所有报文段全部发送,且全部得到确认后,拥塞窗口才增加1个MSS


## Internet网络层

## 数据报网络与虚电路网络
#### 数据报网络(无网络层连接)
  ***按照目的主机地址进行路由选择的网络***
  每台分组交换机有一个把目的地址(或者部分目的地址)映射到某个输出链路的转发表
  特点:
    无连接的发送方和接收方之间不存在固定的连接(或路径),
    发送的分组和接收的分组次序不一定相同,
    每个分组被传送的路径也可能不一致.
    接收方收到分组根据相应的协议对分组排序,生成原始的完整报文,通常有传输层完成
  典型网络: 数据通信,非实时通信
  应用: 因特网

#### 虚电路网络(Virtual-Circuit,VC)
   ***虚电路网络在网络层提供面向连接的分组交换服务***.
   虚电路是在源主机到目的主机的一条路径上建立一条网络层逻辑连接,为区别于电路交换中的电路,称为虚电路
   一条虚电路构成的3个要素:
   1)从源主机到目的主机的一条路径(即一系列的链路和分组交换机)
   2)该路径上的每条链路各有一个虚电路标识(VCID)
   3)该路径上每台分组交换机的转发表中记录虚电路标识的接续关系
  虚电路网络可以保证分组的传输顺序,接收端无须对分组重新排序
   典型网络:传输质量要求高的网络
   应用:
    数据通信网络(X.25网络,帧中继(Frame Relay),异步传输模式(AsyncChronous Transfer Mode,ATM)网络等)

疑问:为什么一条VC不再其路径上的每条链路上都使用同一个VCID?

**数据报网络与虚电路网络区别:**
  依据顺序控制,差错控和流量控制等功能是否由网络来完成还是由端系统完成.虚电路网络通常是由网络完成这些功能,向端系统提供无差错数据服务;数据报网络则是由端系统完成这些功能,网络实现的功能很简单,如基本的路由与转发.

## 网络互连与网络互连设备

#### 异构网络互连
1. ***协议转换***
   协议转换机制采用一类支持异构网络之间协议转换的网络中间设备,实现异构网络之间数据分组的转换与转发.
  中间设备:支持协议转换的网桥或交换机,多协议路由器和应用网关等.可以在除物理层之外的任何一层实现协议转换
2. ***构建虚拟互联网络***
   是在现有异构网络基础上,构建一个同构的虚拟互联网络,异构网络只需封装,转发虚拟互联网络分组,同时引入虚拟互联网中间设备互连异构网络,实现在异构网络间转发统一的虚拟互联网的数据分组
典型:IP网络.Internet是利用IP网络实现的全球最大的互联网络,是典型的网络层实现的网络互连

#### 路由器
路由器从功能体系结构角度,可以分为输入端口,交换结构,输出端口与路由处理器
1. 输入端口
   提供查找,转发的功能,对到达分组缓存排队
2. 交换结构
   基于内存交换:性能最差,价格最便宜
   基于总线交换:无须路由处理器介入即可实现交换功能,具有独占性特征
   基于网络交换:客服单一,独占式总线带来的限制,可以实行并行交换传输.性能最好,价格较昂贵
3. 输出端口
   提供缓存排队功能
   输出端口通常对队列中的分组执行FCFS(先到先服务)的调度策略,也可以执行其他调度策略(按优先级调度,按IP数据报的服务类型调度等)
4. 路由处理器
   路由器的CPU,负责执行路由器的各种指令,包括路由协议的运行,路由计算以及路由表的更新维护

## 网络层拥塞控制
#### 网络拥塞
***网络拥塞曲线分析***
当网络负载较小时,吞吐量的的增长与负载相比基本呈现行关系,分组平均延迟增长缓慢
当负载超过膝点之后,吞吐量随负载增长的速率放缓,分组平均迟延增长较快
当负载超过崖点之后,吞吐量随负载的增加而急剧下降,分组平均迟延急剧上升


1. 拥塞控制和传输层的流量控制区别,是否可以相互取代?
   流量控制是发送数据一方根据接收数据一方的接收数据的能力,包括接缓存,处理速度等,调整数据发送速率和数据量,以避免接收方被数据淹没;拥塞控制则是根据网络的通过能力或网络拥挤程度,来调整数据发送速率和数据量.
   拥塞控制主要考虑端系统之间的网络环境,目的是使网络负载不超过网络的传送能力;而流量控制主要考虑接收端的数据接收与处理能力
2. 发生拥塞的原因
   +   缓冲区容量有限;
   +   传输线路的带宽有限;
   +   网络节点的处理能力有限;
   +   网络中某些部分发生了故障
3. 网络层常采用的拥塞控制措施
#### 流量感知路由
 将网络抽象为一张带权无向图,网络设备抽象为图的节点,链路抽象为图的边,链路费用抽象为边的权值.将网络中链路的权值,设置为以链路带宽,传输延迟,链路负载等为变量的函数,当网络中链路上的负载,延迟发生变化时,链路的权值同样会得到更新.这样在某条链路负载过大的时候,此链路上的流量会被转移至其他链路上.缺点:整个网络可能出现振荡
#### 准入控制
  是一种广泛应用于虚电路网络的拥塞预防技术.当判断网络处于即将发生拥塞的边缘时,拒绝新虚电路的建立将有效避免网络发生拥塞
  方法:基于平均流量和瞬时流量来判断是否有能力接收新虚电路而不发生拥塞
  如果只基于瞬时流量来判断会有什么问题?
#### 流量调节
  当某个网络结点(如路由器)感知到当前网络发生了拥塞时,可以通知其上游网络结点(或端系统)降低发送速率,从而逐渐消除拥塞.
  ***问题: 如何感知拥塞以及发生拥塞时的处理***
  ***对于路由器而言,通过输出端口的排队迟延来对网络拥塞状况进行感知.一般通过过去一段时间的排队时延以及当前的瞬时排队迟延的加权组合来估计当前的排队时延,从而推断网络拥塞状况***
  ***拥塞时处理***
  + 抑制分组
    感知拥塞的路由器选择一个被拥塞的数据报,给该数据报的源主机返回一个抑制分组,抑制分组的目的地址即从被拥塞数据报的源地址得到
  + 背压
    因发送速率过快而导致网络拥塞的网络节点,与感知到拥塞发生的网络节点之间距离较远.在抑制分组到达源节点的过程中,实际上会有很多新的分组进入网络.所以采取的方案就是 ***让抑制分组在从拥塞节点到源节点的路径上的每一跳,都发挥抑制作用.*** 使抑制分组逐跳发挥作用的背压方式,可以使拥塞结点的拥塞状况很快得到缓解,但其代价是抑制分组途径的每一跳都需要分配更大的缓冲区.
#### 负载脱落
  通过有选择地主动丢弃一些数据报,来减轻网络负载,从而缓解或消除网络拥塞.
  一般情况下会选择保留序号较小的数据报,丢弃较大数据报;对于诸如实时视频流应用(如网络直播),则选择保留较新的分组,而丢弃较老的分组.


#### IPv4协议
##### 数据报格式
1. 版本号字段占4位,给出的是IP的版本号.路由根据该字段确定按哪个版本的IP来解析数据报
2. 首部长度字段占4位,给出的是IP数据报的首部长度,包括可变长度的选项字段,以4字节为单位.
3. 区分服务字段占8位,在旧标准中称为服务类型字段,用来指示期望获得哪种类型的服务.只有在网络提供区分服务时,该字段才有效.
4. 数据报长度也称为总长度字段,占16位,给出IP数据报的总字节数.
5. 标识字段占16位,用于标识一个IP数据报.不是标识数据报的唯一标识,最重要的用途是在IP数据报分片和重组过程中,用于标识属于同一原IP数据报.
6. 标志位字段占3位,最高位保留,DF是禁止分片(Don't Fragment)标志,MF是更多分片标志.
7. 片偏移字段占13位,表示一个IP数据报分片封装与原IP数据报数据的相对偏移量,即封装的数据分片从原整个数据报的哪个字节开始.
8. 生存时间(Time-To-Live)字段占8位,表示IP数据报在网络中可以通过的路由器数(或跳步数).如果TTL=0,路由器则丢弃该IP数据报,并向源主机发送Type=11,Code=0的ICMP报文
9. 上层协议字段占8位,指示IP数据报封装的是哪个上层协议的报文段,如6为TCP,即表示封装的TCP报文段,17为UDP,即封装的是UDP数据报.IP是利用该字段实现IP的多路复用与多路分解
10. 首部校验和字段占16位,利用校验和实现对IP数据报首部的差错检测,将收到的数据和收到的校验和求和,只要有一位不为1,表示首部有差错,丢弃改分组.在路由器每次转发分组时需要重新计算后重置
11. 源IP地址字段占32位
12. 目的IP地址字段占32位
13. 选项字段长度可变
14. 数据字段

##### IP数据报分片
最大分片可封装的数据长度(字节)
d = (M-20)/8 * 8 (M为该链路层协议帧所能承载的最大数据量)
需要的IP分片总数
n = (L-20)/d (L为IP数据报总长度单位字节)
每个IP分片的片偏移字段
Fi=d/8*(i-1) 1<=i<=n
每个IP分片的总长度字段为
1 <= i <= n, Li = d + 20  MFi = 1
i = n,  Li = L - d * (n - 1) MFi = 0





#### 动态主机配置协议(DHCP)
DHCP是在应用层实现的.提供动态IP地址分配的网络,需要运行DHCP服务器(端口号67),并且配置其可以为其他主机进行动态地址分配的IP地址范围.
1. DHCP服务器发现:DHCP客户机发送DHCP发现(DHCP Discover)报文,以便发现DHCP服务器
2. DHCP服务器提供.当某太服务器(或路由器)在端口67上提供DHCP服务,在接收到DHCP发现报文后,会发送一个DHCP提供(DHCP Offer)报文来响应主机.提供报文包含了DHCP服务器为新加入网络的主机分配的IP地址,用于标识一次DHCP过程的标识符,子网掩码,默认网关,本地域名服务器IP地址以及IP地址的租期等
3. DHCP请求:新加入网络主机收到一个或多个DHCP服务器提供的DHCP报文之后,选择其中一个通过广播方式发送DHCP请求(DHCP Request)报文
4. DHCP确认:被选定的DHCP服务器以DHCP确认(DHCP ACK)报文来对DHCP请求报文进行响应.当客户机收到DHCP ACK报文后开始正式使用服务器为其分配的IP地址

#### 网络地址转换(Network Address Translation)
解决类似私有地址的主机如何在Internet上进行正常通信的问题
只能由私有地址内网主动发起与公共互联网的通信,但是却不能被动接收外网主机主动与内网主机的通信(可通过NAT穿透技术实现)
NAT一般工作原理:
  对于从内网出去,进入公共互联网的IP数据报,将其源IP地址替换为NAT服务器拥有的合法的公共IP地址,同时替换源端口号,并将替换关系记录到NAT转换表中;对于从公共互联网返回的IP数据报,依据其目的IP地址与目的端口号检索NAT转换表,并利用检索到的内部私有IP地址与对应的端口号替换目的IP地址和目的端口号,然后将IP数据报转发到内部网络.
NAT穿透技术:
  在外网主机主动与内网主机发起通信之前,先在NAT转换表中建立好内网到外网的映射,使内网运行的服务以NAT公网地址的"合法"身份"暴露"出去.只要方法有静态配置和动态配置.

#### ICMP 互联网控制报文协议
  互联网控制报文协议(Internet Control Message Protocol,ICMP)的主要目的是当主机或路由器在处理或ICMP的主要功能是进行主机或路由器间的网络差错报告与网络探测

#### IPv6
相比于IPv4减少了那些字段?这些改进有哪些有点?

##### IPv6地址
1. 单播地址
  唯一标识网络中一个主机或路由器网络接口,可以作为IPv6数据报的源地址和目的地址
2. 组播地址
  标识网络中的一组主机,只能用作IPv6数据报的目的地址,向一个组播地址发送IP数据报,改组播地址标识的多播组每个成员都会收到一个该IP数据报的一个副本
3. 任播地址
   标识网络中的一组主机,只能用作IPv6数据报的目的地址,***但当向一个任播地址发送IP数据报时,只有该任播地址标识的任播组的某个成员收到该IP数据报***

##### IPv4到IPv6的迁移
采用双协议栈,即支持IPv6的网络节点同时也是支持IPv4.
面临的问题:
1. 要求使用双协议栈结点的一方能够感知另一结点提供什么版本的网络服务
   解决方案:通过DNS返回地址判断
2. 通信的源端与目的端途径的中间结点是否提供IPv6服务?
   解决方案:隧道
   隧道:IPv6数据报在途径一段IPv4网络时,可以在IPv4网络上建立IPv6隧道.在IPv6数据报进入隧道前的最后一个IPv6路由器上,将IPv6数据报封装进一个IPv4数据报中,并将改IPv4数据报的目的地址修改为隧道的末端(即隧道后的第一个IPv6路由器).该IPv4数据报在隧道中进行转发,最终到达隧道的出口,在隧道出口的第一个IPv6路由器上,IPv6数据报被从IPv4数据报的有效载荷中提取出来,并继续转发至通信目的主机.