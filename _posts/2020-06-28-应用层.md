---
layout: post
title:  "应用层"
date:   2020-06-28
desc: "about internet network"
keywords: "P2P C/S SMTP DNS FTP"
categories: [Network]
tags: [strawberry]
icon: icon-html
---
## 应用层
#### 一.计算机网络应用体系结构
1. 客户/服务器(C/S)结构： 通信只在客户与服务器之间进行，客户与客户之间不进行直接通信。
2. 纯P2P结构：没有一直在运行的传统服务器，所有通信都是在对等的通信双方之间进行，通信双方没有传统意义上的客户与服务器之分，“地位”对等。
3. 混合结构： 将C/S应用与P2P应用相结合，既有中心服务器的存在，又有对等端(客户)间的直接通信
**网络应用的本质是运行在不同主机或同一主机上的应用进程之间的通信**
**网络应用的基本通信过程就是运行在不同主机上的应用进程间以C/S方式进行的通信**

#### 二.网络通信的基本原理
应用进程通过创建套接字实现与底层协议接口,并进一步通过套接字实现应用进程与底层协议之间的报文交换.
套接字: 相当于每个义应用进程的端口号.通过进程运行的**主机IP地址**以及**套接字所绑定的端口号**可以**标识应用进程**

---

## 域名系统(DNS)
DNS实现域名解析,建立分布式数据库
#### 一.层次化域名空间
因特网采用了层次树状结构的命名方法.
1. 国家顶级域名nTLD: 如cn表示中国,us表示美国,uk表示英国
2. 通用顶级域名gTLD: com(最早的顶级域名,表示公司或企业),org(非盈利组织),edu(专用的教育机构),gov(专用的政府部门),mil(专用的军事部门),int(国际组织),net(网络服务机构)
3. 基础结构域名:这种顶级域名只有一个arpa,用于反向域名解析,因此又称为反向域名.
   
#### 二.域名服务器
一个服务器所负责管辖的范围叫做区(zone).每个区设置一个权威域名服务器.
根据域名服务器主要保存的域名信息以及在域名解析过程中的作用可以分为4类服务器:
1. 根域名服务器
   - 根域名服务器是最重要的域名服务器
   - 在因特网上共有13个不同IP地址的根域名服务器,他们的名字是用一个英文字母命名,从a一直到m
   - 每个根域名服务器都知道所有顶级域名服务器的域名和IP地址
2. 顶级域名服务器
   - 顶级服务器的名称 对应一个域名的最后一个名字,是对一个行业的命名
3. 权威域名服务器
   - 负责管理该顶级域名服务器中注册的所有二级域名
   - 保存该区中所有主机的域名到IP地址的映射
4. 中间域名服务器

#### 三.域名解析过程
域名解析分为**递归解析**和**迭代解析**
域名解析过程:
(1)客户机提出域名解析请求,并将该请求发送给本地的域名服务器;
(2)本地域名服务器收到请求后,先查询本地的缓存,如果有该项记录,则本地域名服务器就直接把查询的结果返回;
(3)如果本地的缓存中没有该记录,则本地域名服务器直接把请求发给根域名服务器,然后根域名服务器再返回给本地域名服务器一个所查询域(根的子域)的主域名服务器的地址;
(4)本地域名服务器再向上一步返回的域名服务器发送请求,然后接受请求的服务器查询自己的缓存,如果没有该记录则返回相关的下级的域名服务器的地址;
(5)重复第四步,知道找到正确的记录;
(6)本地域名服务器把返回的结果保存到缓存,以备下一次使用,同时还将结果返回给客户机

---


## 万维网应用
#### 一.万维网应用结构
万维网应用,也称Web应用.Web应用主要包括**Web服务器**、**浏览器**、**超文本传输协议(HTTP)**
***超文本传输协议HTTP通过URL(统一资源定位器)标识被操作的资源.***
#### 二.HTTP
HTTP是WEB应用的应用层协议,定义浏览器如何向Web服务器发送请求以及Web服务器如何向浏览器进行响应.
主要版本: HTTP/1.0、HTTP/1.1、HTTP/2.0
1. HTTP连接
  **HTTP/1.0 默认使用非持久连接,ＨTTP/1.1默认使用流水方式持久连接**
  - 非持久的HTTP
    非持久HTTP是指HTTP客户与服务器建立TCP连接后,通过该连接发送HTTP请求报文,接收HTTP响应报文,然后断开连接.
  - 持久连接的HTTP  
    - 非流水方式的持久HTTP
      也称为非管道方式持久连接,客户端在通过持久连接后收到前一个响应报文后,才能发出对下一个对象的请求报文.
    - 流水方式的持久HTTP
      也称为管道方式持久连接,客户端在通过持久连接收到前一个对象的响应报文之前,连续依次发送对后续对象的请求报文,然后再通过该连接依次接收服务器发回的响应报文.

```
假设浏览某网页时单击了一个超链接,URL为"http://www.kicker.com.cn/index.html",且该URL对应的IP地址在你的计算机上没有缓存;文件index.html引用了8个小图像.域名解析过程中,无等待的一次DNS解析请求与响应时间记为RTTd,HTTP请求传输Web对象过程的一次往返时间记为RTTh.请回答一下问题:
1)浏览器解析到URL对应的IP地址的最短时间是多少?最长时间是多少?
  最短时间是3个RTTd(本地->根域名返回的子域->子域),最长时间是4个RTTd
2)若浏览器没有配置并行TCP连接,则基于HTTP1.0获取URL链接Web页完整内容(包括引用的图像)需要多长时间(不包括域名解析时间)?
  最要18个RTTh,9个TCP连接,8个请求图像,1个请求Web页
3)若浏览器配置5个并行TCP连接,则基于HTTP1.0获取URL链接Web页完整内容需要多长时间?
  10个RTTh
4)若浏览器没有配置并行TCP连接,则基于非流水方式的HTTP1.1获取URL链接Web页完整内容需要多长时间?基于流水方式的HTTP1.1获取URL链接Web页完整内容需要多长时间?
  非流水10个RTTh;流水方式3个RTTh
```

2. HTTP报文
- 报文组成：起始行、首部行、空白行和实体主体
- 报文分类：请求报文和响应报文
  区别：请求报文与响应报文最主要的区别是起始行不同，请求报文的起始行为：
  <方法><\URL><协议版本>
  响应报文的起始行为：
  <协议版本><状态码><短语>
- HTTP典型请求方法： GET、HEAD、POST、OPTION、PUT

#### 二.Cookie
由于HTTP服务器并不保存关于客户的任何信息，所以HTTP被称为无状态协议。Cookie可以实现在无状态的HTTP之上建立会话,用于用户跟踪。  

---

## 电子邮件
#### 一. 电子邮件系统结构
 - 邮件服务器:发送和接收邮件,同时还要向发信人报告邮件传送的情况(已交付,被拒绝,丢失等),是电子邮件体系结构的核心.一个邮件服务器通常至少包含两个进程(或线程):邮件发送进程(mail sender)和邮件接收进程(mail receiver).邮件接收进程实现SMTP的服务器端,通常绑定默认熟知端口号25,等待其他邮件服务器(邮件发送进程)或用户代理主动请求向其发送邮件;邮件发送进程实现SMTP的客户端,实时监测外出邮件队列,只要队列不空,就依次从队列中取出一个邮件,向接收方的邮件服务器的25号端口(即邮件接收进程)发送.
 - 简单邮件传输协议(SMTP)
 - 用户代理: 电子邮件应用的客户端软件,为用户提供使用电子邮件的接口.主要功能:支持用户撰写,显示,处理和和收发邮件,为用户阅读,回复,转发,保存和撰写邮件等提供编辑与操作环境.典型的用户代理软件有:Outlook,Apple Mail和Fox Mail
 - 邮件读取协议:客户/服务器通信方式,用户代理运行邮件读取协议的客户端,邮件服务器运行邮件读取协议的服务器端

#### 二.SMTP
 **SMTP核心应用层协议特点**:
 1. SMTP只能传送7位ASCII码文内容,包括SMTP命令,应答消息以及邮件内容.
 2. SMTP传送的邮件内容中不能包含"CRLF.CRLF",因为该信息用于标识邮件内容的结束
 3. SMTP是"推动" 协议.当客户端有邮件发送给服务器时,客户主动与服务器(25号端口)请求建立TCP连接,然后将邮件"推送"给服务器.
 4. SMTP使用TCP连接是持久的

***SMTP只能传送7位ASCII码文内容,如果要传输非7位ASCII码文内容?***
***MIME(Multipurpose Internet Mail Extensions),多用途互联网邮件扩展***

#### 三.MIME

MIME定义了将非7为ASCII码内容转换为7位ASCII码的编码规则,并在邮件首部增加MIME首部行,说明主体内容原本的数据类型以及采用的编码标准等.收件人用户代理在读取邮件时,根据邮件首部中的MIME首部行信息,获知邮件主体采用哪种编码,原本数据类型等,然后对主体内容进行解码,还原数据,并调用相应解释程序显示邮件主体内容.

MIME主要包括3个部分
1)5个MIME邮件首部字段,可以包含在首部中.提供了有关邮件主体的信息
- MIME-Version
- Content-Description
- Content-Id:邮件的唯一标识符
- Content-Transfer-Encoding:说明在传送时邮件主题是如何编码的.最简单的编码就是7为ASCII码,而每行不能超过1000个字符,MIME对这种由ASCII码构成的邮件主体不进行任何转换;另一种编码称为quoted-printable,这种编码方法适用于当所传送的数据中只有少量的非ASCII码;对于任意的二进制文件(例如,图像文件,可执行程序等),采用base64编码
Content-Type: 说明邮件主题内容的类型和格式,例如,文本,图像,视频等.MIME标准规定Content-Type必须含有两个标识符,即内容类型和子类型
2)定义了多种邮件内容的格式,对多媒体电子邮件的表示方法进行了标准化
3)定义了邮件传送编码,可对任何内容格式进行转换,从而适合通过SMTP进行传送

#### 四.邮件读取协议
1. 第三版的邮局协议 (Post Office Protocol-Version 3, POP3)
   - 默认熟知端口号:110
   - 用户可以在本地对邮件进行操作 
2. 互联网邮件访问协议 (Internet Mail Access Protocol,IMAP)
   - 允许用户代理只读取邮件的部分内容
   - 允许用户创建远程文件夹并为邮件指派文件夹的功能
3. HTTP
   - 被用作Web Mail系统中的邮件读取协议


---

## FTP
文件传送协议(File Transfer Protocol,FTP),是在互联网的两个主机间实现文件互传的网络应用
- FTP应用使用两个"并行"的TCP连接
  - 控制连接(带外控制)
    - 在整个会话期间一直保持打开,是持久的
    - 负责在客户与服务器之间传输控制信息,熟知端口号:21
  - 数据连接(带内控制)
    - 用于实际传送文件内容,熟知端口号:20
    - 传送完毕后会关闭数据传送连接,非持久,临时的
- FTP是有状态的协议

---

## Socket编程
网络应用进程可以根据需要,创建不同类型的Socket与不同底层协议接口.
网络应用进程可以创建3中类型的Socket:
- 数据报类型套接字SOCK_DGRAW: 面向传输层UDP接口
- 流式套接字SOCK_STREAM: 面向传输层TCP接口
- 原始套接字SOCK_RAW: 面向网络层协议(如IP、ICMP等)接口

---


